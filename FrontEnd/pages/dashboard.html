<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DormDuty Dashboard</title>
    <link rel="stylesheet" href="../styles/dashboard.css">
    <link rel="stylesheet" href="../styles/login.css"> <!-- reuse login styles for buttons etc. -->
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <img src="../logs_backgrounds/DormDuty_logo1.png" alt="DormDuty Logo">
            </div>
            <nav>
                <ul>
                    <li class="active"><a href="#overview">Overview</a></li>
                    <li><a href="#tasks">My Tasks</a></li>
                    <li><a href="#shared">Shared Tasks</a></li>
                    <li><a href="#notifications">Notifications</a></li>
                    <li><a href="#profile">Profile</a></li>
                    <li><a href="index.html">Logout</a></li>
                </ul>
            </nav>
        </aside>
        <main class="dashboard-main">
            <section id="overview" class="dashboard-section">
                <h2>Overview</h2>
                <div class="overview-cards">
                    <div class="card" id="tasks-count">
                        <h3>Tasks</h3>
                        <span>0</span>
                    </div>
                    <div class="card" id="shared-count">
                        <h3>Shared Tasks</h3>
                        <span>0</span>
                    </div>
                    <div class="card" id="notifications-count">
                        <h3>Notifications</h3>
                        <span>0</span>
                    </div>
                </div>
            </section>
            <section id="tasks" class="dashboard-section">
                <h2>My Tasks</h2>
                <div id="tasks-list">
                    <!-- Tasks will be loaded here -->
                </div>
                <button class="add-task-btn">+ Add Task</button>
            </section>
            <section id="shared" class="dashboard-section">
                <h2>Shared Tasks</h2>
                <div id="shared-tasks-list">
                    <!-- Shared tasks will be loaded here -->
                </div>
            </section>
            <section id="notifications" class="dashboard-section">
                <h2>Notifications</h2>
                <div id="notifications-list">
                    <!-- Notifications will be loaded here -->
                </div>
            </section>
            <section id="profile" class="dashboard-section">
                
                <h2>Profile</h2>
                <div class="profile-info">
                    <img id="profile-picture" src="../logs_backgrounds/DormDuty_logo1.png" alt="Profile Picture">
                    <div>
                        <p><strong>Name:</strong> <span id="profile-name"></span></p>
                        <p><strong>Email:</strong> <span id="profile-email"></span></p>
                        <p><strong>Phone:</strong> <span id="profile-phone"></span></p>
                        <p><strong>Room:</strong> <span id="profile-room"></span></p>
                        <p><strong>Building:</strong> <span id="profile-building"></span></p>
                    </div>
                </div>

                <!-- Add inside <section id="profile" ...> -->
                <button id="edit-profile-btn" class="add-task-btn" style="margin-bottom:16px;">Edit Profile</button>
                <form id="profile-edit-form" style="display:none; flex-direction:column; gap:12px; margin-top:16px;">
                    <label>Name: <input type="text" id="edit-profile-name"></label>
                    <label>Email: <input type="email" id="edit-profile-email"></label>
                    <label>Phone: <input type="text" id="edit-profile-phone"></label>
                    <label>Room: <input type="text" id="edit-profile-room"></label>
                    <label>Profile Picture: <input type="file" id="edit-profile-picture" accept="image/*"></label>
                    <button type="submit" class="add-task-btn">Save</button>
                    <button type="button" id="cancel-edit-profile" class="add-task-btn" style="background:#fff;color:#5f6fff;border:2px solid #5f6fff;">Cancel</button>
                </form>
            </section>
        </main>
    </div>
<script>

window.addEventListener('DOMContentLoaded', async () => {
    const user_id = localStorage.getItem('user_id');
    if (!user_id) return;

    const res = await fetch(`http://localhost:8000/accounts/get_profile/?user_id=${user_id}`);
    const data = await res.json();
    if (data.success) {
        document.getElementById('profile-name').textContent = data.user.name || '';
        document.getElementById('profile-email').textContent = data.user.email || '';
        document.getElementById('profile-phone').textContent = data.user.phone_number || '';
        document.getElementById('profile-room').textContent = data.user.room_number || '';
        document.getElementById('profile-building').textContent = data.user.building_id || '';
        if (data.user.profile_picture) {
            document.getElementById('profile-picture').src = data.user.profile_picture + '?t=' + new Date().getTime();
        }
    }
});


const editBtn = document.getElementById('edit-profile-btn');
const form = document.getElementById('profile-edit-form');
const cancelBtn = document.getElementById('cancel-edit-profile');

// Show form with current info
editBtn.onclick = function() {
    form.style.display = 'flex';
    document.getElementById('edit-profile-name').value = document.getElementById('profile-name').textContent;
    document.getElementById('edit-profile-email').value = document.getElementById('profile-email').textContent;
    document.getElementById('edit-profile-phone').value = document.getElementById('profile-phone').textContent;
    document.getElementById('edit-profile-room').value = document.getElementById('profile-room').textContent;
};

// Hide form
cancelBtn.onclick = function() {
    form.style.display = 'none';
};

form.onsubmit = async function(e) {
    e.preventDefault();
    const user_id = localStorage.getItem('user_id');
    const formData = new FormData();
    formData.append('user_id', user_id);
    formData.append('name', document.getElementById('edit-profile-name').value);
    formData.append('email', document.getElementById('edit-profile-email').value);
    formData.append('phone_number', document.getElementById('edit-profile-phone').value);
    formData.append('room_number', document.getElementById('edit-profile-room').value);
    const fileInput = document.getElementById('edit-profile-picture');
    if (fileInput.files.length > 0) {
        formData.append('profile_picture', fileInput.files[0]);
    }

    const res = await fetch('http://localhost:8000/accounts/update_profile/', {
        method: 'POST',
        body: formData
    });
    const data = await res.json();
    if (data.success) {
        document.getElementById('profile-name').textContent = data.user.name;
        document.getElementById('profile-email').textContent = data.user.email;
        document.getElementById('profile-phone').textContent = data.user.phone_number;
        document.getElementById('profile-room').textContent = data.user.room_number;
        if (data.user.profile_picture) {
            document.getElementById('profile-picture').src = data.user.profile_picture + '?t=' + new Date().getTime();
        }
        form.style.display = 'none';
        alert('Profile updated!');
    } else {
        alert('Update failed: ' + (data.error || 'Unknown error'));
    }
};

</script>
</body>
</html>